
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Runtime Await. &#8212; dotty-cps-async 0.9.11-SNAPSHOT documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/nature.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/s4defs-roles.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Additional Features" href="Features.html" />
    <link rel="prev" title="Monad Context" href="MonadContexts.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="Features.html" title="Additional Features"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="MonadContexts.html" title="Monad Context"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">dotty-cps-async 0.9.11-SNAPSHOT documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Runtime Await.</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="runtime-await">
<h1>Runtime Await.<a class="headerlink" href="#runtime-await" title="Permalink to this headline">Â¶</a></h1>
<p>Starting from JDK-19,  the JVM provides lightweight concurrency constructions for representing non-blocking computations in
synchronous form.</p>
<p>We can use those constructions for some monads to escape the need to write shifted variants of high-order functions and,
in some cases, work without the cps transformation of the code inside the <cite>async</cite> macro.</p>
<p>To utilize these possibilities for your monad,  you should implement
<a class="reference external" href="https://github.com/rssh/dotty-cps-async/blob/master/shared/src/main/scala/cps/CpsRuntimeAwait.scala">CpsRuntimeAwait[F]</a> typeclass
(see also a  <a class="reference external" href="https://github.com/rssh/dotty-cps-async/blob/master/jvm/src/main/scala/cps/runtime/LoomRuntimeAwait.scala">LoomRuntimeAwait[F]</a> trait which can be helpful).
If you want to escape cps transformations entirely, mark your implementation as
<a class="reference external" href="https://github.com/rssh/dotty-cps-async/blob/c9d2ca09f1a456c6a27f5bc34287269de5672e2b/shared/src/main/scala/cps/CpsRuntimeAwait.scala#L26">CpsFastRuntimeAwait[F]</a>.
Also,  declare  <cite>given cps.macro.flags.UseLoom.type</cite>  value to enable this feature.</p>
<p>Note that for most effect systems, the cps transformation is still beneficial because of performance reasons.
When processing runtime awaits,  an effect interpreter should start all code thunks, including synchronous API usage,
in the new virtual thread.
Therefore, a hybrid mode, when effect interpretation is based on non-blocking code, and the system starts a virtual thread
only for arguments of hight-order functions, can be more performant.</p>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="MonadContexts.html"
                        title="previous chapter">Monad Context</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="Features.html"
                        title="next chapter">Additional Features</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/RuntimeAwait.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="Features.html" title="Additional Features"
             >next</a> |</li>
        <li class="right" >
          <a href="MonadContexts.html" title="Monad Context"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">dotty-cps-async 0.9.11-SNAPSHOT documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Runtime Await.</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020-2022, Ruslan Shevchenko.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.3.1.
    </div>
  </body>
</html>